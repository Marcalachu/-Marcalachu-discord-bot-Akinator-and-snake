import discord
from discord.ext import commands
import random
import asyncio
import json

# ConfiguraciÃ³n del bot
TOKEN = 'TU_TOKEN_AQUI'  # Reemplaza con tu token de Discord
intents = discord.Intents.default()
intents.message_content = True  # Habilitar el intent de contenido de mensajes
intents.reactions = True  # Habilitar el uso de reacciones
bot = commands.Bot(command_prefix='!', intents=intents)

# Variables para el juego Snake
snake_body = []
food_position = (0, 0)
snake_direction = "RIGHT"
snake_game_active = False
snake_players = 0  # Contador de jugadores en Snake

# Variables para el juego Akinator
akinator_questions = [
    "Â¿Es un personaje real?",
    "Â¿Es un personaje de una pelÃ­cula?",
    "Â¿Es un superhÃ©roe?",
    "Â¿Es un personaje de un videojuego?",
    "Â¿Es un personaje de una serie de televisiÃ³n?"
]
akinator_players = 0  # Contador de jugadores en Akinator

# Creador del bot
creator = "Marcalachu"  # Nombre del creador del bot

# Cargar el Ã¡rbol de decisiones desde un archivo JSON
def load_decision_tree():
    try:
        with open('decision_tree.json', 'r') as f:
            return json.load(f)
    except FileNotFoundError:
        # Crear Ã¡rbol de decisiones inicial en caso de fallo
        return {
            "Â¿Es un personaje real?": {
                "sÃ­": {
                    "Â¿Es un cientÃ­fico?": {
                        "sÃ­": {
                            "Â¿Es conocido por su trabajo en fÃ­sica?": {
                                "sÃ­": "Albert Einstein",
                                "no": "Marie Curie"
                            }
                        },
                        "no": {
                            "Â¿Es un polÃ­tico?": {
                                "sÃ­": {
                                    "Â¿Es un presidente?": {
                                        "sÃ­": "Barack Obama",
                                        "no": "Angela Merkel"
                                    }
                                },
                                "no": {
                                    "Â¿Es un youtuber?": {
                                        "sÃ­": {
                                            "Â¿Es un gamer?": {
                                                "sÃ­": "PewDiePie",
                                                "no": "Lilly Singh"
                                            }
                                        },
                                        "no": "Elon Musk"
                                    }
                                }
                            }
                        }
                    },
                    "Â¿Es un artista?": {
                        "sÃ­": {
                            "Â¿Es un mÃºsico?": {
                                "sÃ­": {
                                    "Â¿Es un cantante de rock?": {
                                        "sÃ­": "Freddie Mercury",
                                        "no": "BeyoncÃ©"
                                    }
                                },
                                "no": "Pablo Picasso"
                            }
                        },
                        "no": {
                            "Â¿Es un escritor?": {
                                "sÃ­": {
                                    "Â¿Es conocido por novelas de ciencia ficciÃ³n?": {
                                        "sÃ­": "Isaac Asimov",
                                        "no": "Gabriel GarcÃ­a MÃ¡rquez"
                                    }
                                },
                                "no": {
                                    "Â¿Es un director de cine?": {
                                        "sÃ­": "Steven Spielberg",
                                        "no": "J.K. Rowling"
                                    }
                                }
                            }
                        }
                    }
                },
                "no": {
                    "Â¿Es un superhÃ©roe?": {
                        "sÃ­": {
                            "Â¿Es de Marvel?": {
                                "sÃ­": {
                                    "Â¿Es parte de los Vengadores?": {
                                        "sÃ­": "Iron Man",
                                        "no": "Deadpool"
                                    }
                                },
                                "no": "Batman"
                            }
                        },
                        "no": {
                            "Â¿Es un personaje de dibujos animados?": {
                                "sÃ­": {
                                    "Â¿Es de Disney?": {
                                        "sÃ­": "Mickey Mouse",
                                        "no": "Bugs Bunny"
                                    }
                                },
                                "no": "Shrek"
                            }
                        }
                    },
                    "Â¿Es un personaje de videojuegos?": {
                        "sÃ­": {
                            "Â¿Es un personaje de Nintendo?": {
                                "sÃ­": "Mario",
                                "no": "Master Chief"
                            }
                        },
                        "no": {
                            "Â¿Es un personaje de libros?": {
                                "sÃ­": {
                                    "Â¿Es de Harry Potter?": {
                                        "sÃ­": "Harry Potter",
                                        "no": "Frodo Baggins"
                                    }
                                },
                                "no": "Sherlock Holmes"
                            }
                        }
                    }
                }
            },
            "Â¿Es un personaje de ficciÃ³n?": {
                "sÃ­": {
                    "Â¿Es un personaje de una serie de televisiÃ³n?": {
                        "sÃ­": {
                            "Â¿Es un personaje principal?": {
                                "sÃ­": "Walter White",
                                "no": "Jim Halpert"
                            }
                        },
                        "no": {
                            "Â¿Es un personaje de una pelÃ­cula?": {
                                "sÃ­": {
                                    "Â¿Es un villano?": {
                                        "sÃ­": "Darth Vader",
                                        "no": "Harry Potter"
                                    }
                                },
                                "no": "Gandalf"
                            }
                        }
                    },
                    "Â¿Es un personaje de un libro?": {
                        "sÃ­": {
                            "Â¿Es de una novela clÃ¡sica?": {
                                "sÃ­": "Elizabeth Bennet",
                                "no": "Katniss Everdeen"
                            }
                        },
                        "no": {
                            "Â¿Es un personaje de un videojuego?": {
                                "sÃ­": {
                                    "Â¿Es un personaje de acciÃ³n?": {
                                        "sÃ­": "Lara Croft",
                                        "no": "Kirby"
                                    }
                                },
                                "no": "SpongeBob SquarePants"
                            }
                        }
                    }
                },
                "no": {
                    "Â¿Es un animal?": {
                        "sÃ­": {
                            "Â¿Es un animal domÃ©stico?": {
                                "sÃ­": "Perro",
                                "no": "Elefante"
                            }
                        }
                    }
                }
            }
        }

        

        # Guardar el Ã¡rbol de decisiones
        def save_decision_tree(tree):
            with open('decision_tree.json', 'w') as f:
                json.dump(tree, f)

        # Comando para jugar Akinator
        @bot.command()
        async def akinator(ctx):
            decision_tree = load_decision_tree()
            await ctx.send("Â¡Comencemos a jugar Akinator! Piensa en un personaje y yo intentarÃ© adivinarlo.")

            current_node = decision_tree

            while isinstance(current_node, dict):
                for question, answers in current_node.items():
                    await ctx.send(question)
                    def check(m):
                        return m.author == ctx.author and m.channel == ctx.channel

                    try:
                        response = await bot.wait_for('message', check=check, timeout=15.0)
                        response = response.content.lower()

                        if response in ["sÃ­", "si", "yes", "y"]:
                            current_node = answers["sÃ­"]
                        elif response in ["no", "n", "nope"]:
                            current_node = answers["no"]
                        else:
                            await ctx.send("Por favor, responde con 'sÃ­' o 'no'.")
                            continue
                    except asyncio.TimeoutError:
                        await ctx.send("Â¡Tiempo agotado! El juego ha terminado.")
                        return

            # Adivinar el personaje
            guessed_character = current_node
            await ctx.send(f"Â¡Creo que el personaje en el que pensabas es {guessed_character}!")

            # Confirmar si el personaje es correcto
            await ctx.send("Â¿Es correcto? (sÃ­/no)")
            def check(m):
                return m.author == ctx.author and m.channel == ctx.channel

            try:
                response = await bot.wait_for('message', check=check, timeout=15.0)
                if response.content.lower() in ["sÃ­", "si", "yes", "y"]:
                    await ctx.send("Â¡Genial! Me alegra haber adivinado correctamente.")
                elif response.content.lower() in ["no", "n", "nope"]:
                    # AquÃ­ se capturan y actualizan nuevas respuestas
                    await ctx.send("Â¡Oh no! Â¿CuÃ¡l era el personaje?")
                    new_character = await bot.wait_for('message', check=check, timeout=15.0)
                    await ctx.send("Â¿QuÃ© pregunta podrÃ­a ayudarme a adivinarlo?")
                    new_question = await bot.wait_for('message', check=check, timeout=15.0)

                    # Actualizar el Ã¡rbol de decisiones
                    decision_tree[new_question.content] = {
                        "sÃ­": new_character.content,
                        "no": guessed_character
                    }
                    save_decision_tree(decision_tree)
                    await ctx.send("Â¡Gracias! He aprendido algo nuevo.")
                else:
                    await ctx.send("No entendÃ­ tu respuesta. Por favor, responde 'sÃ­' o 'no'.")
            except asyncio.TimeoutError:
                await ctx.send("Â¡Tiempo agotado! El juego ha terminado.")

        # Comando para jugar Snake
        @bot.command()
        async def snake(ctx):
            global snake_body, food_position, snake_direction, snake_game_active, snake_players
            snake_body = [(0, 0)]
            food_position = (random.randint(0, 9), random.randint(0, 9))
            snake_direction = "RIGHT"
            snake_game_active = True

            await ctx.send("Â¡Comenzando el juego Snake! Usa las reacciones para moverte. ğŸğŸ")
            game_board = await ctx.send(render_board())
            await game_board.add_reaction("â¬…ï¸")
            await game_board.add_reaction("â¡ï¸")
            await game_board.add_reaction("â¬†ï¸")
            await game_board.add_reaction("â¬‡ï¸")

            def check(reaction, user):
                return user == ctx.author and str(reaction.emoji) in ["â¬…ï¸", "â¡ï¸", "â¬†ï¸", "â¬‡ï¸"]

            while snake_game_active:
                try:
                    reaction, user = await bot.wait_for('reaction_add', check=check, timeout=10.0)
                    # Actualizar direcciÃ³n segÃºn la reacciÃ³n
                    # ...
                    update_snake_position()
                    await game_board.edit(content=render_board())
                    await asyncio.sleep(0.5)
                except asyncio.TimeoutError:
                    snake_game_active = False
                    await ctx.send("Â¡Tiempo agotado! El juego ha terminado.")

            await ctx.send("Â¡Juego de Snake terminado!")

        @bot.event
        async def on_ready():
            print(f'Conectado como {bot.user.name} (ID: {bot.user.id})')
            print('------')
            await bot.change_presence(activity=discord.Game(name="Â¡Bienvenido! Usa !akinator o !snake"))

        # Ejecutar el bot
        bot.run(TOKEN)